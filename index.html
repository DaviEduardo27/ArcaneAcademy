<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcane Academy [BETA] | Davi Eduardo (Kyter)</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=MedievalSharp&family=Pirata+One&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <style>
        /* --- CORE VISUAL --- */
        :root {
            --bg-deep: #050505; --accent-gold: #c5a028; --accent-glow: #ffd700; --danger-red: #8b0000;
            --magic-blue: #00a8cc; --combo-orange: #d35400; --chaos-purple: #6c3483; --panel-bg: rgba(5, 5, 8, 0.95);
            --paper-color: #e3dac9; --ink-color: #1a1a1a; --glass-dark: rgba(0, 0, 0, 0.9);
            --rew-silver: #bdc3c7; --rew-mythril: #1abc9c; --rew-cosmic: #8e44ad;
        }
        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; outline: none; }
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Cinzel', serif; color: #d0d0d0; cursor: default; }

        /* --- BACKGROUNDS --- */
        #dynamic-bg-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; background-size: cover; background-position: center; transition: opacity 1s ease, filter 1s ease; opacity: 0.6; filter: contrast(1.1) saturate(0.9); }
        .env-default { background: radial-gradient(circle at center, #1a0b2e 0%, #000000 100%); }
        .env-glacia{background-image:url('Imagens/Fundos/bg_glacia.jpg');} .env-thalros{background-image:url('Imagens/Fundos/bg_thalros.jpg');} 
        .env-umbra{background-image:url('Imagens/Fundos/bg_umbra.jpg');} .env-ferrum{background-image:url('Imagens/Fundos/bg_ferrum.jpg');} 
        .env-solari{background-image:url('Imagens/Fundos/bg_solari.jpg');} .env-aurelius{background-image:url('Imagens/Fundos/bg_aurelius.jpg');} 
        .env-malakor{background-image:url('Imagens/Fundos/bg_malakor.jpg');} .env-sertis{background-image:url('Imagens/Fundos/bg_sertis.jpg');} 
        .env-trion{background-image:url('Imagens/Fundos/bg_trion.jpg');} .env-gaiaos{background-image:url('Imagens/Fundos/bg_gaiaos.jpg');}

        /* --- VFX --- */
        #magic-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        #combo-pulse-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, transparent 0%, #000 100%); z-index: 2; transition: background 0.2s ease; pointer-events: none; mix-blend-mode: overlay; }
        #vfx-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; overflow: hidden; }
        .magic-spark { position: absolute; width: 6px; height: 6px; background: #fff; border-radius: 50%; box-shadow: 0 0 10px #fff, 0 0 20px var(--accent-gold); pointer-events: none; }
        .spell-projectile { position: absolute; width: 40px; height: 40px; border-radius: 50%; background: radial-gradient(circle, #fff, var(--magic-blue)); box-shadow: 0 0 20px var(--magic-blue), 0 0 40px #fff; z-index: 9000; pointer-events: none; mix-blend-mode: screen; }
        #fx-overlay, #fade-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 8000; opacity: 0; }
        #fade-layer { background: #000; z-index: 10000; transition: opacity 0.8s; }
        .fade-active { opacity: 1 !important; pointer-events: all !important; }
        body.eco-mode #magic-canvas, body.eco-mode .card:hover, body.eco-mode #dynamic-bg-layer { display: none !important; }

        /* --- SCREENS --- */
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; flex-direction: column; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.5s; z-index: 10; }
        .screen.active { display: flex; opacity: 1; z-index: 50; }

        /* --- INTRO --- */
        #screen-intro { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 20000; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .intro-container { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .magic-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, transparent 30%, rgba(0, 10, 30, 0.95) 85%, #000000 100%); pointer-events: none; z-index: 20001; }
        #intro-video { width: 100%; height: 100%; object-fit: contain; opacity: 0.8; z-index: 20000; box-shadow: 0 0 50px rgba(0, 100, 200, 0.3); }
        
        #start-btn-intro { z-index: 20002; position: absolute; top: 80%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.7); border: 1px solid rgba(100, 200, 255, 0.5); color: #e0f7ff; padding: 18px 50px; font-family: 'Cinzel'; font-size: 1.5rem; letter-spacing: 4px; text-transform: uppercase; cursor: pointer; transition: all 0.4s ease; backdrop-filter: blur(4px); box-shadow: 0 0 40px rgba(0, 0, 0, 0.9); opacity: 1; }
        #start-btn-intro:hover { background: rgba(0, 50, 100, 0.9); border-color: var(--magic-blue); box-shadow: 0 0 60px var(--magic-blue); color: #fff; transform: translate(-50%, -50%) scale(1.05); }
        #skip-text { position: absolute; bottom: 30px; right: 40px; z-index: 20002; font-family: 'Cinzel'; color: rgba(255,255,255,0.4); font-size: 0.8rem; letter-spacing: 3px; cursor: pointer; display: none; text-transform: uppercase; }

        /* --- MENU (CORRIGIDO: Background Contain) --- */
        #screen-menu { 
            background: url('Imagens/CapaGame.jpg') no-repeat center center; 
            background-size: contain; /* GARANTE QUE A IMAGEM INTEIRA APARE√áA SEM CORTES */
            background-color: #000; /* Preenche o resto com preto se a tela for diferente da imagem */
            width: 100%; height: 100%;
        }
        
        .menu-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, transparent 40%, rgba(5, 10, 30, 0.6) 70%, #000 100%);
            z-index: 1; pointer-events: none;
        }

        .menu-card { 
            width: 100%; height: 100%; 
            background: transparent; 
            border: none; box-shadow: none; 
            display: flex; flex-direction: column; justify-content: flex-end; align-items: center; 
            overflow: hidden; z-index: 2;
        }

        .title-glow-fx { position: absolute; top: 0; width: 100%; height: 40%; background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent); pointer-events: none; z-index: 5; }
        .beta-badge { position: absolute; top: 30px; right: 40px; font-family: 'Cinzel'; font-size: 1.2rem; font-weight: bold; color: rgba(255, 255, 255, 0.8); letter-spacing: 4px; z-index: 100; text-shadow: 0 0 10px rgba(0, 168, 204, 0.8); }
        
        /* CARROSSEL CLEAN & 3D */
        .menu-options-container { 
            width: 100%; 
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);
            padding: 40px 0 80px 0;
            display: flex; justify-content: center; align-items: flex-end; 
            gap: 40px;
            perspective: 1500px; 
            min-height: 400px; 
            z-index: 2000; 
            overflow-x: auto; 
            border: none; box-shadow: none;
        }
        
        .menu-options-container::-webkit-scrollbar { display: none; }

        .magic-menu-card { 
            width: 180px; height: 260px; flex-shrink: 0; 
            background: rgba(10, 12, 16, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1); 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); 
            border-radius: 8px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; 
            cursor: pointer; 
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); 
            position: relative; backdrop-filter: blur(10px); 
            transform-style: preserve-3d;
        }
        
        .card-icon { font-size: 4rem; color: #aaa; transition: 0.4s; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.5)); }
        .card-label { font-family: 'Cinzel'; font-size: 1rem; font-weight: 700; color: #aaa; text-transform: uppercase; letter-spacing: 3px; transition: 0.4s; margin-top: 10px; }
        
        .magic-menu-card:hover { 
            transform: translateY(-25px) scale(1.05); 
            background: rgba(10, 20, 40, 0.9); 
            border-color: var(--magic-blue); 
            box-shadow: 0 0 50px rgba(0, 168, 204, 0.6), inset 0 0 20px rgba(0, 168, 204, 0.2); 
            z-index: 10;
        }
        .magic-menu-card:hover .card-icon { color: #fff; filter: drop-shadow(0 0 20px var(--magic-blue)); transform: scale(1.1) translateZ(20px); }
        .magic-menu-card:hover .card-label { color: #fff; text-shadow: 0 0 15px var(--magic-blue); transform: translateZ(20px); }
        
        .magic-menu-card:active { transform: translateY(-20px) scale(0.95); filter: brightness(1.2); transition: 0.1s; }
        
        .magic-menu-card.disabled { opacity: 0.3; filter: grayscale(1); pointer-events: none; display:none; }

        /* --- UI & HUD --- */
        .panel-glass { background: var(--panel-bg); border: 1px solid var(--accent-gold); padding: 40px; border-radius: 4px; text-align: center; width: 500px; max-width: 90%; box-shadow: 0 30px 80px rgba(0,0,0,1); }
        .btn-main { background: rgba(0,0,0,0.6); border: 1px solid rgba(197, 160, 40, 0.3); color: var(--accent-gold); font-family: 'Cinzel'; font-size: 1rem; padding: 15px 0; cursor: pointer; transition: 0.3s; width: 100%; text-transform: uppercase; letter-spacing: 3px; margin-top: 10px; }
        .btn-main:hover { background: rgba(197, 160, 40, 0.1); border-color: var(--accent-gold); box-shadow: 0 0 15px rgba(197, 160, 40, 0.2); }
        .hud-top { width: 100%; padding: 20px 40px; display: flex; justify-content: space-between; align-items: flex-start; z-index: 100; pointer-events: none; background: linear-gradient(to bottom, #000, transparent); }
        .profile-card-hud, .stats-card-hud { pointer-events: auto; background: rgba(10, 12, 16, 0.8); padding: 10px 25px; border-radius: 4px; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1); }
        .profile-card-hud { display: flex; align-items: center; gap: 15px; border-left: 3px solid var(--accent-gold); }
        .avatar-frame { width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--accent-gold); background: #000; overflow: hidden; position: relative; } .avatar-frame img { width: 100%; height: 100%; object-fit: cover; }
        .stats-card-hud { display: flex; gap: 40px; font-family: 'Cinzel'; font-size: 1.1rem; }
        .val-gold { color: var(--accent-gold); } .val-blue { color: var(--magic-blue); }
        .game-area { display: flex; align-items: center; justify-content: center; gap: 60px; margin-top: 40px; width: 100%; transform-style: preserve-3d; z-index: 10; }
        .boss-panel { width: 300px; text-align: center; position: relative; }
        .boss-img { width: 250px; height: 250px; margin: 0 auto; animation: float 4s infinite ease-in-out; } .boss-img img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.8)); }
        .boss-hp-bg { width: 100%; height: 6px; background: #222; margin-top: 15px; border-radius: 3px; border: 1px solid #444; }
        .boss-hp-fill { width: 100%; height: 100%; background: linear-gradient(90deg, #c0392b, #e74c3c); transition: 0.3s; }
        .boss-speech-bubble { position: absolute; top: -100px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 15px 20px; border-radius: 4px; font-family: 'MedievalSharp'; font-size: 1rem; width: 260px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); opacity: 0; pointer-events:none; transition: opacity 0.5s; border: 2px solid #000; }
        @keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-20px);} }
        
        /* Auras & Effects */
        .aura-ice .avatar-frame { border-color: var(--magic-blue); box-shadow: 0 0 15px var(--magic-blue); }
        .aura-fire .avatar-frame { border-color: var(--danger-red); box-shadow: 0 0 15px var(--danger-red); }
        .aura-lightning .avatar-frame { border-color: var(--accent-glow); box-shadow: 0 0 20px var(--accent-glow); }
        .aura-shadow .avatar-frame { border-color: var(--chaos-purple); box-shadow: 0 0 25px var(--chaos-purple); }
        .aura-light .avatar-frame { border-color: #fff; box-shadow: 0 0 30px #fff; }
        .boss-hit { animation: hitBasic 0.2s; } @keyframes hitBasic { 0%{filter:brightness(10) contrast(2);} 100%{filter:brightness(1);} }
        .boss-hit-ice { animation: hitIce 0.5s; } @keyframes hitIce { 0%{filter:brightness(3) hue-rotate(180deg) saturate(5);} 100%{filter:brightness(1);} }
        .boss-hit-fire { animation: hitFire 0.5s; } @keyframes hitFire { 0%{filter:brightness(3) sepia(1) saturate(5) hue-rotate(-30deg);} 100%{filter:brightness(1);} }
        .boss-hit-shock { animation: hitShock 0.4s; } @keyframes hitShock { 0%{filter:invert(1);} 20%,80%{transform:translateX(5px);} 40%,60%{transform:translateX(-5px);} 100%{filter:none;} }
        .boss-hit-void { animation: hitVoid 0.6s; } @keyframes hitVoid { 0%{filter:grayscale(1) brightness(0); transform:scale(0.95);} 100%{filter:none; transform:scale(1);} }

        /* CARDS */
        .card-grid { display: grid; gap: 15px; perspective: 1000px; z-index: 10; } .grid-4 { grid-template-columns: repeat(4, 1fr); } .grid-5 { grid-template-columns: repeat(5, 1fr); }
        .card { width: 85px; height: 120px; cursor: pointer; position: relative; transform-style: preserve-3d; transition: transform 0.5s; animation: cardFloat 3s infinite alternate ease-in-out; }
        @keyframes cardFloat { 0% { transform: translateY(0); } 100% { transform: translateY(-8px); } }
        .card.flipped, .card.matched { transform: rotateY(180deg); animation: none; }
        .card:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.8); }
        .face { width: 100%; height: 100%; position: absolute; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; backface-visibility: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.8); }
        .front { background: #dcdde1; transform: rotateY(180deg); border: 2px solid #555; color: #222; }
        .back { background: linear-gradient(145deg, #1a1a1a, #050505); border: 1px solid #333; color: #444; position: relative; overflow: hidden; }
        .back::after { content: '‚öú'; opacity: 0.2; font-size: 2rem; }
        .card.matched .front { border-color: #fff; box-shadow: 0 0 20px var(--accent-gold); }
        .card.chaos-glow { box-shadow: 0 0 40px var(--chaos-purple), inset 0 0 20px var(--chaos-purple); border: 2px solid var(--chaos-purple); animation: none; }
        /* Skins */
        .card-skin-silver .back { background: linear-gradient(145deg, #34495e, #2c3e50); border-color: #7f8c8d; color: #95a5a6; }
        .card-skin-gold .back { background: linear-gradient(145deg, #b7950b, #7d6608); border-color: #f1c40f; color: #f9e79f; }
        .card-skin-diamond .back { background: linear-gradient(145deg, #2980b9, #1f618d); border-color: #5dade2; color: #aed6f1; }
        .card-skin-mythril .back { background: linear-gradient(145deg, #16a085, #0b5345); border-color: #48c9b0; color: #a2d9ce; box-shadow: inset 0 0 15px rgba(26, 188, 156, 0.3); }
        .card-skin-cosmic .back { background: linear-gradient(145deg, #4a235a, #000, #154360); border-color: #d2b4de; color: #e8daef; animation: cosmicShift 8s infinite alternate; }
        @keyframes cosmicShift { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(40deg); } }

        /* --- NOTIFICA√á√ïES & POPUPS --- */
        #magic-alert-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 30000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .magic-alert-box { background: linear-gradient(135deg, #1a1a1a, #050505); border: 2px solid var(--accent-gold); padding: 40px 60px; text-align: center; border-radius: 8px; box-shadow: 0 0 50px rgba(197, 160, 40, 0.3); max-width: 450px; display:flex; flex-direction:column; align-items:center; gap:20px; transform: scale(0.8); opacity: 0; transition: all 0.3s ease; }
        .magic-alert-box.show { transform: scale(1); opacity: 1; }
        .magic-alert-box h3 { color: var(--accent-gold); font-family: 'Cinzel'; font-size: 1.8rem; margin:0; }
        .magic-alert-box p { color: #ddd; font-family: 'MedievalSharp'; font-size: 1.2rem; margin:0; }
        .magic-alert-btn { background: transparent; border: 1px solid var(--accent-gold); color: var(--accent-gold); padding: 12px 35px; font-family: 'Cinzel'; cursor: pointer; transition: 0.3s; font-size: 1rem; text-transform:uppercase; } .magic-alert-btn:hover { background: var(--accent-gold); color: #000; }

        .notification-bar { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #000; padding: 15px 60px; border: 1px solid var(--accent-gold); font-family: 'Cinzel'; font-size: 1.2rem; color: var(--accent-gold); opacity: 0; pointer-events: none; transition: opacity 0.5s; z-index: 20000; text-shadow: 0 0 10px var(--accent-gold); box-shadow: 0 10px 40px rgba(0,0,0,1); }
        .notification-bar.show { opacity: 1; }
        #achievement-popup { position: fixed; top: 30px; left: 50%; transform: translateX(-50%) translateY(-150px); background: linear-gradient(to bottom, #947c20, #63500d); padding: 2px; border-radius: 6px; box-shadow: 0 15px 50px rgba(0,0,0,1); z-index: 200000; transition: transform 0.6s; pointer-events: none; }
        .ach-inner { background: #0f0f12; padding: 20px 30px; border-radius: 4px; display: flex; align-items: center; gap: 20px; color: var(--accent-gold); min-width: 350px; }
        #achievement-popup.show { transform: translateX(-50%) translateY(0); }
        .ach-icon { font-size: 3rem; filter: drop-shadow(0 0 10px rgba(197, 160, 40, 0.5)); }
        .ach-text { text-align: left; }
        .ach-title { font-family: 'Cinzel', bold; font-size: 1.1rem; margin-bottom: 5px; text-transform: uppercase; color: #fff; letter-spacing: 1px; }
        .ach-desc { font-family: 'MedievalSharp'; font-size: 0.9rem; color: #aaa; }
        .btn-gear { position: fixed; bottom: 30px; right: 30px; font-size: 2.5rem; color: rgba(255,255,255,0.2); cursor: pointer; z-index: 5000; transition: 0.3s; }
        .btn-gear:hover { transform: rotate(90deg); color: var(--accent-gold); opacity: 1; }

        .float-score { position: absolute; font-family: 'Cinzel'; font-weight: bold; color: var(--accent-gold); text-shadow: 0 0 5px #000; pointer-events: none; z-index: 500; animation: floatUp 0.8s forwards; font-size: 1.5rem; }
        @keyframes floatUp { 0%{opacity:1; transform:translateY(0);} 100%{opacity:0; transform:translateY(-40px);} }
        #combo-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); z-index: 500; pointer-events: none; }
        .combo-text { font-size: 5rem; font-weight: bold; font-family: 'MedievalSharp'; text-shadow: 0 0 30px rgba(0,0,0,0.8); animation: pop 0.5s forwards; color: var(--combo-orange); }
        @keyframes pop { 0%{transform:scale(0); opacity:0;} 50%{transform:scale(1.2); opacity:1;} 100%{transform:scale(1); opacity:0;} }

        /* QUIZ */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 5000; display: none; align-items: center; justify-content: center; perspective: 1500px; }
        .newspaper { width: 550px; max-height: 85vh; background: #d6cfc7 url('https://www.transparenttextures.com/patterns/aged-paper.png'); color: #111; padding: 30px; border: 1px solid #000; outline: 3px double #222; box-shadow: 0 0 100px rgba(0,0,0,1); transform-style: preserve-3d; opacity: 0; transform: scale(0) rotate(720deg); display: flex; flex-direction: column; }
        .news-header { font-family: 'Pirata One'; text-align: center; border-bottom: 3px double #111; padding-bottom: 15px; margin-bottom: 15px; } .news-title { font-size: 4rem; margin: 0; text-transform: uppercase; line-height: 0.9; }
        .quiz-question-box { font-family: 'MedievalSharp'; font-size: 1.4rem; text-align: center; margin: 25px 0; font-weight: bold; color: #000; padding: 20px; background: rgba(0,0,0,0.05); border: 1px solid #aaa; }
        .quiz-opt-btn { background: transparent; border: 2px solid #222; padding: 15px; font-family: 'Cinzel'; font-weight: 700; font-size: 1rem; cursor: pointer; transition: 0.2s; text-align: center; color: #222; margin-bottom: 10px; width: 100%; } .quiz-opt-btn:hover { background: #222; color: #e3dac9; }
        .owl-fx { position: absolute; top: -300px; left: 50%; transform: translateX(-50%); font-size: 10rem; z-index: 6000; pointer-events: none; filter: drop-shadow(0 40px 30px rgba(0,0,0,0.6)); opacity: 0; }
        
        /* Config Panel */
        .avatar-selector { margin: 20px; display: flex; justify-content: center; align-items: center; gap: 20px; } .prof-img-large { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent-gold); } .arrow-btn { background: none; border: none; color: #555; font-size: 3rem; cursor: pointer; transition: 0.2s; } .arrow-btn:hover { color: var(--accent-gold); } .input-magico { background: transparent; border: none; border-bottom: 1px solid var(--accent-gold); color: #fff; font-size: 1.5rem; padding: 10px; text-align: center; width: 80%; font-family: 'Cinzel'; margin: 20px 0; outline: none; }
        .dash-header { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; justify-content: center; } .dash-avatar { width: 100px; height: 100px; border-radius: 50%; border: 2px solid var(--accent-gold); background: #000; overflow: hidden; } .dash-avatar img { width: 100%; height: 100%; object-fit: cover; } .dash-info h1 { margin: 0; color: var(--accent-gold); } .dash-stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; } .stat-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 2px; border: 1px solid #333; } .stat-label { font-size: 0.7rem; color: #666; text-transform: uppercase; letter-spacing: 1px; } .stat-val-big { font-size: 1.8rem; color: #fff; font-family: 'Cinzel'; } .btn-delete-save { border-color: var(--danger-red); color: var(--danger-red); opacity: 0.6; margin-top: 20px; font-size: 0.8rem; } .btn-delete-save:hover { background: rgba(139, 0, 0, 0.2); border-color: #ff3333; color: #ff3333; opacity: 1; }
        .cfg-section { margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; } .cfg-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; color: #aaa; font-family: 'Cinzel'; font-size: 0.9rem; } input[type=range] { width: 50%; accent-color: var(--accent-gold); } select.cfg-input { background: #000; border: 1px solid #444; color: #fff; padding: 5px 10px; font-family: 'Cinzel'; }
        
        /* Grimorio */
        .grimoire-container { width: 900px; max-width: 95vw; height: 700px; max-height: 90vh; background: #e3dac9 url('https://www.transparenttextures.com/patterns/aged-paper.png'); border: 10px solid #2c1e0b; border-radius: 8px; box-shadow: 0 0 100px rgba(0,0,0,1), inset 0 0 150px rgba(44, 30, 11, 0.4); display: flex; flex-direction: column; padding: 40px; position: relative; overflow: hidden; perspective: 1500px; color: #1a0b00; } .grimoire-header { text-align: center; border-bottom: 3px double #5d4037; padding-bottom: 15px; margin-bottom: 25px; } .grimoire-title { font-family: 'UnifrakturMaguntia'; font-size: 3.5rem; color: #2c1e0b; margin: 0; } .grimoire-subtitle { font-family: 'Cinzel'; font-size: 1.1rem; color: #5d4037; font-weight: bold; } .grimoire-page { flex-grow: 1; display: flex; flex-direction: column; align-items: center; opacity: 1; transform-origin: center center; backface-visibility: hidden; overflow-y: auto; padding-right: 10px; } .grimoire-intro-text { font-family: 'MedievalSharp'; font-size: 1.3rem; color: #2c1e0b; text-align: center; line-height: 1.8; margin: 60px 0; font-style: italic; } .boss-portrait { width: 180px; height: 180px; border: 4px double #5d4037; border-radius: 50%; overflow: hidden; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); background: #fff; } .boss-portrait img { width: 100%; height: 100%; object-fit: cover; } .boss-name-title { font-family: 'MedievalSharp'; font-size: 2rem; color: #8b0000; margin-bottom: 5px; } .boss-honorific { font-family: 'Cinzel'; font-size: 1.1rem; font-weight: bold; color: #555; margin-bottom: 25px; font-style: italic; border-bottom: 1px solid #ccc; padding-bottom: 10px; } .boss-lore-text { font-family: 'MedievalSharp'; font-size: 1.2rem; color: #2c1e0b; text-align: justify; line-height: 1.6; padding: 0 30px; } .grimoire-nav { display: flex; justify-content: space-between; align-items: center; margin-top: 25px; padding-top: 15px; border-top: 1px solid rgba(93, 64, 55, 0.3); } .page-btn { background: none; border: none; font-family: 'UnifrakturMaguntia'; font-size: 2.5rem; color: #5d4037; cursor: pointer; transition: 0.2s; } .page-btn:hover { color: #8b0000; transform: scale(1.1); } .page-btn:disabled { color: #ccc; cursor: default; transform: none; } .page-number { font-family: 'Cinzel'; font-weight: bold; color: #555; } .grimoire-actions { margin-top: 15px; display: flex; gap: 20px; justify-content: center; } .ach-list { width: 100%; padding: 0 20px; } .ach-item { display: flex; align-items: center; gap: 20px; padding: 15px; border-bottom: 1px solid rgba(93, 64, 55, 0.3); opacity: 0.4; filter: grayscale(1); transition: 0.3s; } .ach-item.unlocked { opacity: 1; filter: grayscale(0); background: rgba(212, 175, 55, 0.15); } .ach-item-icon { font-size: 2.5rem; color: #5d4037; } .ach-item.unlocked .ach-item-icon { color: #b7950b; text-shadow: 0 0 5px rgba(183, 149, 11, 0.5); } .ach-item-text { text-align: left; } .ach-item-text h4 { margin: 0; font-family: 'Cinzel'; color: #2c1e0b; font-size: 1.1rem; font-weight: bold; } .ach-item-text p { margin: 5px 0 0 0; font-family: 'MedievalSharp'; font-size: 0.95rem; color: #555; }

        #exit-screen { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:99999; flex-direction:column; align-items:center; justify-content:center; color:#555; opacity:0; transition:opacity 1s; }
    </style>
</head>
<body>
    <div id="dynamic-bg-layer" class="env-default"></div>
    <canvas id="magic-canvas"></canvas>
    <div id="vfx-container"></div>
    <div id="fx-overlay"></div>
    <div id="combo-pulse-layer"></div>
    <div id="fade-layer"></div>
    <div id="combo-container"></div>
    <div class="notification-bar" id="notif-bar">Mensagem</div>
    <div style="display:none;" id="motes"></div> <div id="magic-alert-modal">
        <div class="magic-alert-box" id="magic-modal-content">
            </div>
    </div>

    <div id="modal-quiz" class="modal-overlay">
        <div class="newspaper" id="quiz-paper">
            <div class="news-header"><div class="news-title">O Profeta Arcano</div><div class="news-subtitle"><span>EDI√á√ÉO EXTRA</span><span>ACADEMIA</span><span>URGENTE</span></div></div>
            <div class="news-content"><div class="headline">TEMPO ESGOTADO!</div><div class="sub-headline">Responda para evitar a expuls√£o eminente.</div><div class="quiz-question-box"><p id="quiz-q">Pergunta...</p></div><div id="quiz-ops"></div></div>
            <div class="news-footer">O CONSELHO AGUARDA SUA RESPOSTA.</div>
        </div>
    </div>

    <div id="achievement-popup"><div class="ach-inner"><div class="ach-icon" id="ach-pop-icon">üèÜ</div><div class="ach-text"><div class="ach-title" id="ach-pop-title">Conquista!</div><div class="ach-desc" id="ach-pop-desc">Desc.</div></div></div></div>
    <div class="owl-fx" id="fx-owl">ü¶â</div>
    
    <audio id="ost-menu" src="Sons/musica_menu.mp3" loop></audio> 
    <audio id="ost-game" src="Sons/musica_jogo.mp3" loop></audio>

    <div id="screen-intro">
        <div class="intro-container">
            <div class="magic-overlay"></div>
            <video id="intro-video" muted playsinline preload="auto" loop autoplay><source src="Videos/intro.mp4" type="video/mp4"></video>
            <div id="start-btn-intro" onclick="playIntroSound()">INICIAR JORNADA</div>
            <div id="skip-text" onclick="endIntro()">PULAR INTRO</div>
        </div>
    </div>

    <div id="screen-menu" class="screen">
        <div class="menu-overlay"></div>
        <div class="menu-card">
            <div class="title-glow-fx"></div><div class="beta-badge">BETA PATCH 2.1</div>
            <div class="menu-options-container">
                <div class="magic-menu-card disabled" id="btn-continue" onclick="playS('click'); continuarJogo()"><div class="card-icon">üìú</div><div class="card-label">Continuar</div></div>
                <div class="magic-menu-card" onclick="playS('click'); novoJogo()"><div class="card-icon">‚ú®</div><div class="card-label">Jogar</div></div>
                <div class="magic-menu-card" id="btn-infinite" style="display:none; border-color:var(--chaos-purple);" onclick="playS('click'); iniciarModoInfinito()"><div class="card-icon" style="color:var(--chaos-purple);">‚ôæÔ∏è</div><div class="card-label" style="color:var(--chaos-purple);">Infinito</div></div>
                <div class="magic-menu-card" id="btn-grimoire-menu" style="display:none; border-color:var(--accent-gold);" onclick="playS('click'); abrirGrimorioDireto()"><div class="card-icon" style="color:var(--accent-gold);">üìñ</div><div class="card-label" style="color:var(--accent-gold);">Grim√≥rio</div></div>
                <div class="magic-menu-card" onclick="playS('click'); abrirPerfilMenu()"><div class="card-icon">üßô‚Äç‚ôÇÔ∏è</div><div class="card-label">Perfil</div></div>
                <div class="magic-menu-card" onclick="playS('click'); openConfigMenu('menu')"><div class="card-icon">‚öôÔ∏è</div><div class="card-label">Op√ß√µes</div></div>
            </div>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="hud-top">
            <div class="profile-card-hud" id="hud-avatar-container"><div class="avatar-frame"><img id="hud-av-img" src="" alt="Av"></div><div class="player-info"><div class="p-name" id="hud-name">Player</div><div class="p-lvl">N√≠vel <span id="hud-lvl">1</span></div></div></div>
            <div class="stats-card-hud"><span>Fase <b class="val-gold" id="ui-fase">1</b></span><span id="box-tempo">Tempo <b class="val-gold" id="ui-tempo">60</b></span><span>Pts <b class="val-blue" id="ui-score">0</b></span></div>
        </div>
        <div class="game-area">
            <div class="boss-panel">
                <div id="boss-speech" class="boss-speech-bubble">...</div>
                <div id="boss-vis" class="boss-img"><img id="boss-img-tag" src="" alt="Boss"></div>
                <div style="margin-top:10px; color:var(--accent-gold); font-weight:bold;" id="boss-n">BOSS</div>
                <div class="boss-hp-bg"><div class="boss-hp-fill" id="hp-bar"></div></div>
            </div>
            <div class="card-grid grid-4" id="board"></div>
        </div>
        <div class="btn-gear" onclick="playS('click'); openConfigMenu('game')">‚öôÔ∏è</div>
    </div>

    <div id="screen-profile" class="screen">
        <div class="panel-glass">
            <h2 style="color:var(--accent-gold)">REGISTRO M√ÅGICO</h2>
            <div id="profile-edit">
                <div class="avatar-selector"><button class="arrow-btn" onclick="playS('click'); mudarAvatar(-1)">‚ùÆ</button><img id="prof-av-edit" class="prof-img-large" src=""><button class="arrow-btn" onclick="playS('click'); mudarAvatar(1)">‚ùØ</button></div>
                <input type="text" id="prof-name-input" class="input-magico" placeholder="Seu Nome"><br><br>
                <div class="btn-main" onclick="playS('click'); salvarPerfil()">Salvar</div>
                <div class="btn-main" style="margin-top:10px; opacity:0.7;" onclick="playS('click'); navegar('screen-menu')">Voltar</div>
            </div>
            <div id="profile-dash" style="display:none;">
                <div class="dash-header"><div class="dash-avatar"><img id="dash-av-img" src=""></div><div class="dash-info"><h1 id="dash-name">Nome</h1><div id="dash-title">Aprendiz</div></div></div>
                <div class="dash-stats-grid"><div class="stat-box"><div class="stat-label">N√çVEL</div><div class="stat-val-big" id="dash-lvl">1</div></div><div class="stat-box"><div class="stat-label">RECORDE</div><div class="stat-val-big" id="dash-score">0</div></div></div>
                <div class="btn-main" onclick="playS('click'); editarPerfil()">Editar</div>
                <div class="btn-main" onclick="playS('click'); navegar('screen-menu')">Voltar</div>
                <div class="btn-delete-save" onclick="deletarSave()">APAGAR SAVE</div>
            </div>
        </div>
    </div>

    <div id="screen-settings" class="screen">
        <div class="panel-glass">
            <h2 style="color:var(--accent-gold)">OP√á√ïES</h2>
            <div class="cfg-section"><h3>√ÅUDIO</h3><div class="cfg-row"><span>M√∫sica</span><input type="range" min="0" max="1" step="0.1" id="rng-musica" oninput="setAudio('m', this.value)"></div><div class="cfg-row"><span>Efeitos</span><input type="range" min="0" max="1" step="0.1" id="rng-sfx" oninput="setAudio('s', this.value)"></div></div>
            <div class="cfg-section"><h3>GR√ÅFICOS</h3><div class="cfg-row"><span>Part√≠culas</span><input type="checkbox" id="chk-part" onchange="setGfx('part', this.checked)"></div></div>
            <div class="btn-main" onclick="playS('click'); voltarConfig()">Voltar</div>
            <div id="btn-quit-match" class="btn-main" style="border-color:var(--combo-orange); color:var(--combo-orange); display:none; margin-top:10px;" onclick="playS('click'); sairParaMenu()">Desistir</div>
            <div class="btn-main" style="border-color:var(--danger-red); color:var(--danger-red); margin-top:10px;" onclick="fecharJogo()">Sair do Jogo</div>
        </div>
    </div>

    <div id="screen-credits" class="screen" style="background:#000; z-index:10000; display:none;">
        <div class="grimoire-container">
            <div class="grimoire-header"><h1 class="grimoire-title">Grim√≥rio das Lendas</h1><div class="grimoire-subtitle">Os Desafios Superados</div></div>
            <div id="book-content" class="grimoire-page"></div>
            <div class="grimoire-nav"><button class="page-btn" id="prev-btn" onclick="prevPage()">‚ùÆ</button><div class="page-number">P√°gina <span id="page-num">1</span></div><button class="page-btn" id="next-btn" onclick="nextPage()">‚ùØ</button></div>
        </div>
        <div class="grimoire-actions"><div class="btn-main" style="width:200px;" onclick="playS('click'); sairParaMenu()">Menu Principal</div></div>
    </div>

    <div id="exit-screen"><div style="font-family:'Cinzel'; font-size:2rem; margin-bottom:20px; color:var(--accent-gold); text-shadow:0 0 10px var(--accent-gold);">At√© logo, Mago.</div></div>

    <script>
        let ipcRenderer; try { ipcRenderer = require('electron').ipcRenderer; } catch(e) {}
        console.log("Arcane Academy [BETA] - Patch 2.1: MENU REFORGED");

        /* --- 1. DADOS (BOSSES, ITEMS, QUIZ, CONQUISTAS) --- */
        const avatares = [ { file: "mago_aprendiz.png", color: "#3498db" }, { file: "feiticeira_natureza.png", color: "#2ecc71" }, { file: "guerreiro_magico.png", color: "#e74c3c" }, { file: "mago_sabio.png", color: "#9b59b6" }, { file: "feiticeira_lua.png", color: "#00d2ff" } ];
        const titulos = ["Aprendiz", "Novato", "Estudante", "Adepto", "Feiticeiro", "Mago", "Bruxo", "Encantador", "Mestre", "Gr√£o-Mestre", "Arquimago", "Auror", "Lenda", "Semideus", "Divindade Arcana"];
        const bosses = [
            { n:"Glacia", title:"A Sentinela do Inverno", file:"fada_gelo.png", color:"#00d2ff", lore:"Antigamente uma fada que trazia o orvalho da manh√£, Glacia foi corrompida quando um estudante tentou aprisionar o frio em um frasco. Agora, ela protege o Pico de Cristal, acreditando que qualquer estranho √© um ladr√£o de ess√™ncia √°rtica.", env:"env-glacia", phrases:["Voc√™ vai congelar!", "Minha neve ser√° seu t√∫mulo.", "Sinta o abra√ßo g√©lido."] },
            { n:"Thalros", title:"O Tit√£ de Pedra", file:"golem_pedra.png", color:"#d35400", lore:"Thalros n√£o foi constru√≠do para lutar, mas para servir de biblioteca viva para as primeiras runas de prote√ß√£o. Com o tempo, o musgo cobriu suas escrituras e ele esqueceu os comandos de desativa√ß√£o. Ele esmaga qualquer um que considere uma amea√ßa ao conhecimento antigo.", env:"env-thalros", phrases:["Esmagar intruso!", "Sua magia √© fraca contra rocha.", "Volte ao p√≥!"] },
            { n:"Umbra", title:"O Eco do Abismo", file:"espectro_sombras.png", color:"#8e44ad", lore:"Umbra √© a am√°lgama dos medos deixados para tr√°s por alunos que falharam. Ela n√£o possui forma f√≠sica constante, habitando as sombras dos corredores proibidos e alimentando-se da hesita√ß√£o de quem ousa atravess√°-los.", env:"env-umbra", phrases:["Seu medo tem cheiro doce...", "Abrace a escurid√£o.", "N√£o h√° luz aqui."] },
            { n:"Ferrum", title:"O Golem de Ferro", file:"gargula_ferro.png", color:"#7f8c8d", lore:"Forjado durante a Grande Guerra M√°gica para ser indestrut√≠vel. Ele √© uma m√°quina de guerra movida por um feiti√ßo de sangue que o obriga a guardar o port√£o principal at√© que seu mestre ‚Äî morto h√° s√©culos ‚Äî o dispense.", env:"env-ferrum", phrases:["Exterm√≠nio: Ativado.", "Carne √© fraca. A√ßo √© eterno.", "Eliminar intruso."] },
            { n:"Solari", title:"A F√™nix Renascida", file:"fenix_fogo.png", color:"#e67e22", lore:"Solari surge apenas quando a magia da academia est√° inst√°vel. Sua luz √© t√£o intensa que pode cegar os impuros. Para os her√≥is, derrot√°-la n√£o √© um ato de viol√™ncia, mas um teste de resist√™ncia ao calor absoluto.", env:"env-solari", phrases:["Queime na verdade!", "O fogo purifica.", "Cinzas √†s cinzas."] },
            { n:"Aurelius", title:"O Drag√£o da Gan√¢ncia", file:"dragao_dourado.png", color:"#f1c40f", lore:"Um drag√£o que se apaixonou pelos tesouros da escola. A magia acumulada fundiu o ouro de sua toca diretamente em suas escamas. Ele v√™ cada item do seu invent√°rio como uma joia que deve pertencer a ele.", env:"env-aurelius", phrases:["Meu tesouro!", "Vou derreter sua armadura.", "Ladr√£ozinho!"] },
            { n:"Malakor", title:"O Feiticeiro Sombrio", file:"feiticeiro_trevas.png", color:"#2c3e50", lore:"O maior vil√£o da hist√≥ria da academia. Malakor foi o diretor mais brilhante, mas sua obsess√£o pela imortalidade o corrompeu. Agora ele √© uma casca de poder arcano, drenando a magia da ilha para sustentar sua exist√™ncia.", env:"env-malakor", phrases:["Eu vi a verdade.", "Sua magia √© pat√©tica.", "Curve-se!"] },
            { n:"Sertis", title:"A Serpente do Veneno", file:"basilisco.png", color:"#27ae60", lore:"Nos esgotos, o descarte de po√ß√µes falhas criou Sertis. Esta serpente colossal sofreu muta√ß√µes qu√≠micas, desenvolvendo um veneno que n√£o apenas mata o corpo, mas corrompe a pr√≥pria mana da v√≠tima.", env:"env-sertis", phrases:["Ssssil√™ncio...", "Sinta o veneno.", "N√£o olhe meus olhos."] },
            { n:"Trion", title:"A Quimera Ca√≥tica", file:"quimera.png", color:"#c0392b", lore:"Um experimento de fus√£o falho. Trion possui tr√™s mentes em um corpo, cada uma lutando pelo controle. O le√£o ruge por for√ßa, o lobo por instinto e a serpente por mal√≠cia. Seus ataques s√£o imprevis√≠veis.", env:"env-trion", phrases:["Rugido! Uivo! Sibilado!", "Caos encarnado!", "Despeda√ßar!"] },
            { n:"Gaiaos", title:"O Esp√≠rito da Terra", file:"elemental_terra.png", color:"#795548", lore:"Gaiaos √© a pr√≥pria ilha se levantando contra os magos. Ele sente a dor da minera√ß√£o de cristais e v√™ a academia como um parasita. Ele representa a f√∫ria final da natureza contra a manipula√ß√£o m√°gica.", env:"env-gaiaos", phrases:["A natureza cobra.", "Retorne ao solo!", "F√∫ria antiga."] }
        ];
        const items = ['‚öîÔ∏è', 'üõ°Ô∏è', 'üß™', 'üìú', 'üíé', 'üíç', 'üîÆ', 'üóùÔ∏è', 'üåô', 'üî•', '‚ö°', 'üëÅÔ∏è', 'üï∏Ô∏è', 'üëë', 'ü©∏', '‚öñÔ∏è'];
        const triviaDB = [
            {p:"Qual destes n√£o √© um elemento cl√°ssico?", o:["Fogo","Vento","Metal"], r:2}, {p:"O que alquimistas buscavam?", o:["Pedra Filosofal","Ouro L√≠quido","Vida Eterna"], r:0},
            {p:"Qual criatura renasce das cinzas?", o:["Drag√£o","F√™nix","Grifo"], r:1}, {p:"Qual destas √© uma ferramenta de adivinha√ß√£o?", o:["Bola de Cristal","Varinha","Caldeir√£o"], r:0},
            {p:"O que bruxas usam para voar?", o:["Tapetes","Vassouras","Arbustos"], r:1}, {p:"Qual √© a cor da magia do caos neste jogo?", o:["Azul","Roxo","Verde"], r:1},
            {p:"Qual destes √© um morto-vivo?", o:["Vampiro","Lobisomem","Elfo"], r:0}, {p:"Onde po√ß√µes s√£o preparadas?", o:["Forno","Caldeir√£o","Frasco"], r:1},
            {p:"Qual criatura petrifica com o olhar?", o:["Basilisco","Medusa","G√≥rgona"], r:0}, {p:"Qual √© o s√≠mbolo da realeza?", o:["Coroa","Cetro","Anel"], r:0}
        ];

        const achievementsDB = [
            {id:'win_1',icon:'‚ú®',title:'Iniciado',desc:'Ven√ßa a Fase 1.'}, {id:'win_5',icon:'üî•',title:'Intermedi√°rio',desc:'Ven√ßa a Fase 5.'}, {id:'win_10',icon:'üëë',title:'O Fim do In√≠cio',desc:'Complete o Modo Hist√≥ria (Fase 10).'},
            {id:'lvl_5',icon:'üìú',title:'Estudante',desc:'Alcance N√≠vel 5.'}, {id:'lvl_10',icon:'üìò',title:'Adepto',desc:'Alcance N√≠vel 10.'}, {id:'lvl_25',icon:'üßô‚Äç‚ôÇÔ∏è',title:'Mago',desc:'Alcance N√≠vel 25.'}, {id:'lvl_50',icon:'üîÆ',title:'Arquimago',desc:'Alcance N√≠vel 50.'}, {id:'lvl_100',icon:'üåü',title:'Lenda Arcana',desc:'Alcance o N√≠vel M√°ximo (100).'},
            {id:'combo_3',icon:'‚ö°',title:'R√°pido',desc:'Combo de 3x.'}, {id:'combo_5',icon:'üå©Ô∏è',title:'Rel√¢mpago',desc:'Combo de 5x.'}, {id:'combo_8',icon:'üå™Ô∏è',title:'Tempestade',desc:'Combo de 8x.'}, {id:'combo_10',icon:'üî•',title:'Impar√°vel',desc:'Combo de 10x.'}, {id:'combo_max',icon:'üí•',title:'Perfei√ß√£o',desc:'Combo m√°ximo na fase (sem errar).'},
            {id:'score_500',icon:'üí∞',title:'Bolsa Cheia',desc:'500 pts numa partida.'}, {id:'score_1k',icon:'üíé',title:'Tesouro',desc:'1.000 pts numa partida.'}, {id:'score_3k',icon:'üè∞',title:'Fortuna',desc:'3.000 pts numa partida.'}, {id:'score_5k',icon:'üëë',title:'Magnata',desc:'5.000 pts numa partida.'},
            {id:'kill_glacia',icon:'‚ùÑÔ∏è',title:'Quebra-Gelo',desc:'Derrote Glacia.'}, {id:'kill_thalros',icon:'ü™®',title:'Demolidor',desc:'Derrote Thalros.'}, {id:'kill_umbra',icon:'üåë',title:'Iluminado',desc:'Derrote Umbra.'}, {id:'kill_ferrum',icon:'‚öôÔ∏è',title:'Ferrugem',desc:'Derrote Ferrum.'}, {id:'kill_solari',icon:'‚òÄÔ∏è',title:'Extintor',desc:'Derrote Solari.'},
            {id:'kill_aurelius',icon:'üêâ',title:'Matador de Drag√µes',desc:'Derrote Aurelius.'}, {id:'kill_malakor',icon:'‚ò†Ô∏è',title:'Luz da Justi√ßa',desc:'Derrote Malakor.'}, {id:'kill_sertis',icon:'üêç',title:'Ant√≠doto',desc:'Derrote Sertis.'}, {id:'kill_trion',icon:'ü¶Å',title:'Domador',desc:'Derrote Trion.'}, {id:'kill_gaiaos',icon:'üåç',title:'Terra Arrasada',desc:'Derrote Gaiaos.'},
            {id:'quiz_win',icon:'üß†',title:'S√°bio',desc:'Acerte um Quiz.'}, {id:'quiz_clutch',icon:'‚è±Ô∏è',title:'No Limite',desc:'Acerte Quiz com <5s restantes.'}, {id:'chaos_survivor',icon:'üåÄ',title:'Ordem no Caos',desc:'Ven√ßa ap√≥s 3 eventos de Caos.'}, {id:'low_hp',icon:'‚ù§Ô∏è‚Äçü©π',title:'Por um Fio',desc:'Ven√ßa com 1 HP.'},
            {id:'speedster',icon:'üëü',title:'Ligeirinho',desc:'Ven√ßa em menos de 25s.'}, {id:'veteran_10',icon:'üéñÔ∏è',title:'Veterano I',desc:'Jogue 10 partidas.'}, {id:'veteran_50',icon:'üèÖ',title:'Veterano II',desc:'Jogue 50 partidas.'}, {id:'veteran_100',icon:'üèÜ',title:'Veterano III',desc:'Jogue 100 partidas.'},
            {id:'infinite_15',icon:'‚ôæÔ∏è',title:'Eterno',desc:'Fase 15 no Infinito.'}, {id:'completionist',icon:'üìñ',title:'Historiador',desc:'Grim√≥rio Completo.'}, {id:'collector',icon:'üÉè',title:'Colecionador',desc:'Desbloqueie todas as skins de carta.'}, {id:'fashion',icon:'üßô‚Äç‚ôÄÔ∏è',title:'Estiloso',desc:'Use todos os avatares.'},
            {id:'placeholder1',icon:'‚ùì',title:'Segredo I',desc:'Continue jogando...'}, {id:'placeholder2',icon:'‚ùì',title:'Segredo II',desc:'Continue jogando...'}, {id:'placeholder3',icon:'‚ùì',title:'Segredo III',desc:'Continue jogando...'}, {id:'placeholder4',icon:'‚ùì',title:'Segredo IV',desc:'Continue jogando...'}, {id:'placeholder5',icon:'‚ùì',title:'Segredo V',desc:'Continue jogando...'},
            {id:'placeholder6',icon:'‚ùì',title:'Segredo VI',desc:'Continue jogando...'}, {id:'placeholder7',icon:'‚ùì',title:'Segredo VII',desc:'Continue jogando...'}, {id:'placeholder8',icon:'‚ùì',title:'Segredo VIII',desc:'Continue jogando...'}
        ];

        /* --- 2. √ÅUDIO E ESTADO --- */
        const sfx = { flip:new Audio('Sons/flip.mp3'), match:new Audio('Sons/match.mp3'), win:new Audio('Sons/win.mp3'), click:new Audio('Sons/click.mp3'), chaos:new Audio('Sons/chaos.mp3'), swear:new Audio('Sons/raio.mp3'), achievement:new Audio('Sons/win.mp3'), alohomora:new Audio('Sons/alohomora.mp3'), combo:new Audio('Sons/combo.mp3'), expelliarmus:new Audio('Sons/expelliarmus.mp3'), thunder:new Audio('Sons/raio.mp3'), owl:new Audio('Sons/owl.mp3'), paper:new Audio('Sons/paper.mp3') };
        
        class AudioManager { 
            constructor(){this.bgMusic=null;this.gameMusic=null;}
            init(){this.bgMusic=document.getElementById('ost-menu');this.gameMusic=document.getElementById('ost-game');this.bgMusic.volume=0.4;this.gameMusic.volume=0.3;}
            playMenu(){if(this.gameMusic)this.gameMusic.pause();if(this.bgMusic){this.bgMusic.currentTime=0;this.bgMusic.play().catch(()=>{});}} 
            playGame(){if(this.bgMusic)this.bgMusic.pause();if(this.gameMusic){this.gameMusic.currentTime=0;this.gameMusic.play().catch(()=>{});}} 
            stopAll(){if(this.bgMusic)this.bgMusic.pause();if(this.gameMusic)this.gameMusic.pause();} 
            updateVolume(){if(this.bgMusic)this.bgMusic.volume=cfg.m;if(this.gameMusic)this.gameMusic.volume=cfg.m;} 
        } 
        const audioManager = new AudioManager();

        let globalData = JSON.parse(localStorage.getItem('aa_global')) || { achievements: [] };
        let prof = JSON.parse(localStorage.getItem('aa_prof')) || { nome: "Aprendiz", av: 0, lvl: 1, xp: 0, maxScore: 0, totalGames: 0 };
        let cfg = JSON.parse(localStorage.getItem('aa_cfg')) || { m: 0.5, s: 0.5, part: true };
        let game = { fase: 1, score: 0, infiniteMode: false, chaosActive: false };
        let cartas=[], pares=0, total=0, travado=false, hp=0, hpMax=0, combo=0, tempo=0, timer=null, chaosTimer=null, tauntTimer=null, deckQuiz=[], lastScreen='screen-menu', currentBossIndex=0;

        /* --- 3. INICIALIZA√á√ÉO --- */
        window.onload = () => {
            audioManager.init(); // Inicializa audio quando o DOM existe
            initParticles(); updateProfUI(); applySettings(); checkSave();
            const vid = document.getElementById('intro-video'); vid.muted=true; vid.loop=true; vid.play().catch(()=>{});
            gsap.to("#start-btn-intro", { opacity: 1, duration: 1, delay: 0.5 });
            document.addEventListener("mousemove", resetAFKTimer); resetAFKTimer();
        };

        /* --- 4. NAVEGA√á√ÉO E FLUXO PRINCIPAL --- */
        function playIntroSound() { const vid=document.getElementById('intro-video'); vid.muted=false; vid.loop=false; vid.currentTime=0; vid.play(); document.getElementById('start-btn-intro').style.display='none'; document.getElementById('skip-text').style.display='block'; vid.onended=endIntro; }
        function endIntro() { document.getElementById('intro-video').pause(); gsap.to('#screen-intro', {opacity:0, duration:1, onComplete:()=>{ document.getElementById('screen-intro').style.display='none'; navegar('screen-menu'); audioManager.playMenu(); }}); }
        function navegar(id) { document.querySelectorAll('.screen').forEach(s=>{s.classList.remove('active');s.style.display='none';}); const t=document.getElementById(id); if(t){t.style.display='flex';setTimeout(()=>t.classList.add('active'),10);} }
        
        function novoJogo() { if(prof.nome==="Aprendiz"){notificar("Configure seu perfil!");abrirPerfilMenu();return;} localStorage.removeItem('aa_save'); game={fase:1,score:0,infiniteMode:false,chaosActive:false}; prof.totalGames++; localStorage.setItem('aa_prof',JSON.stringify(prof)); checkAchievements('game_start'); audioManager.playGame(); transitionFase(1); }
        function continuarJogo() { const s=JSON.parse(localStorage.getItem('aa_save')); if(s){game=s;audioManager.playGame();transitionFase(game.fase);} }

        function transitionFase(f) {
            const fade = document.getElementById('fade-layer'); fade.classList.add('fade-active'); playS('alohomora');
            setTimeout(() => {
                document.getElementById('screen-menu').style.display = 'none'; navegar('screen-game'); // For√ßa sa√≠da do menu
                try { carregarFase(f); } catch(e) { console.error(e); sairParaMenu(); } finally { setTimeout(()=>fade.classList.remove('fade-active'), 500); }
            }, 800);
        }

        function carregarFase(f) {
            game.fase = f; document.getElementById('ui-fase').innerText = f; document.getElementById('ui-score').innerText = game.score; document.getElementById('board').innerHTML = '';
            let bIdx = (f-1)%bosses.length; if(game.infiniteMode) bIdx = Math.floor(Math.random()*bosses.length); currentBossIndex = bIdx; const b = bosses[bIdx];
            document.getElementById('boss-img-tag').src = `Imagens/Monstros/${b.file}`; document.getElementById('boss-n').innerText = b.n; document.getElementById('boss-n').style.color = b.color; document.getElementById('dynamic-bg-layer').className = b.env;
            
            let n=16; if(f>=3) n=20; if(f>=6) n=24; 
            const p=n/2; hpMax=p; hp=p; updateHP(); total=p; pares=0; cartas=[]; travado=false; combo=0;
            
            const gridClass = (n===20)?'grid-5':'grid-4'; 
            const rewards = getRewards(prof.lvl);
            document.getElementById('board').className = `card-grid ${gridClass} ${rewards.cardSkin}`;
            
            let deck = items.slice(0, p); deck = [...deck, ...deck].sort(()=>Math.random()-0.5);
            deck.forEach(icon => {
                const c = document.createElement('div'); c.className = 'card'; c.dataset.icon = icon; c.innerHTML = `<div class="face front">${icon}</div><div class="face back"></div>`;
                c.onclick = () => cardClick(c, icon); document.getElementById('board').appendChild(c);
            });
            clearInterval(timer); startTimer(60); 
            scheduleNextChaos(); scheduleTaunt(); if(!game.infiniteMode) localStorage.setItem('aa_save', JSON.stringify(game));
        }

        function cardClick(c, val) {
            if(travado || game.chaosActive || c.classList.contains('flipped')) return;
            playS('flip'); c.classList.add('flipped'); cartas.push({el:c, v:val});
            if(cartas.length === 2) {
                travado = true; const [c1, c2] = cartas;
                if(c1.v === c2.v) {
                    playS('match'); c1.el.classList.add('matched'); c2.el.classList.add('matched'); pares++; hp--; updateHP(); combo++; showCombo(combo);
                    let pts = Math.floor(100*combo); game.score+=pts; document.getElementById('ui-score').innerText=game.score; showFloatScore(c1.el, pts);
                    cartas=[]; travado=false;
                    if(pares === total) {
                        clearInterval(timer); clearTimeout(chaosTimer); clearTimeout(tauntTimer);
                        setTimeout(() => { playS('win'); finishStage(); }, 1000);
                    }
                } else {
                    combo=0; setTimeout(()=>{c1.el.classList.remove('flipped');c2.el.classList.remove('flipped');cartas=[];travado=false;},800);
                }
            }
        }

        // NOVO FLUXO DE FIM DE FASE
        function finishStage() {
            const xpGained = 100 + (game.score/10); prof.xp += xpGained;
            let msg = `Vit√≥ria! +${Math.floor(xpGained)} XP.`;
            if(prof.xp >= prof.lvl*100 && prof.lvl < 100) { prof.xp=0; prof.lvl++; msg = `LEVEL UP! N√≠vel ${prof.lvl}!`; checkAchievements('levelup'); }
            localStorage.setItem('aa_prof', JSON.stringify(prof)); updateProfUI();
            
            notificar(msg);
            setTimeout(() => {
                const modalContent = document.getElementById('magic-modal-content');
                modalContent.innerHTML = `<h3>Fase ${game.fase} Conclu√≠da!</h3><p>${msg}</p><div style="display:flex; gap:20px; margin-top:20px;"><button class="magic-alert-btn" onclick="closeMagicAlert(); transitionFase(game.fase+1)">Continuar</button><button class="magic-alert-btn" style="border-color:var(--danger-red); color:var(--danger-red);" onclick="closeMagicAlert(); sairParaMenu()">Menu</button></div>`;
                document.getElementById('magic-alert-modal').style.display = 'flex';
                setTimeout(() => modalContent.classList.add('show'), 10);
            }, 1500);
        }

        /* --- 5. MEC√ÇNICAS --- */
        function startTimer(t) { tempo=t; document.getElementById('ui-tempo').innerText=tempo; timer=setInterval(()=>{tempo--;document.getElementById('ui-tempo').innerText=tempo;if(tempo<=0){clearInterval(timer);quiz("Tempo Esgotado!");}},1000); }
        function updateHP() { document.getElementById('hp-bar').style.width = ((hp/hpMax)*100)+'%'; }
        function scheduleNextChaos() { clearTimeout(chaosTimer); const time = Math.random()*(15000-10000)+10000; chaosTimer = setTimeout(() => { triggerChaosShuffle(); scheduleNextChaos(); }, time); }
        function triggerChaosShuffle() {
            const validCards = Array.from(document.querySelectorAll('.card:not(.flipped):not(.matched)')); if (validCards.length < 2) return;
            game.chaosActive = true; playS('chaos'); notificar("Caos! Embaralhando...");
            validCards.forEach(c => c.classList.add('chaos-glow'));
            gsap.to(validCards, { 
                duration: 0.6, scale: 0.8, rotation: "random(-180, 180)", x: "random(-50, 50)", y: "random(-50, 50)", opacity: 0.7, ease: "power2.inOut",
                onComplete: () => {
                    const icons = validCards.map(c => c.dataset.icon).sort(() => Math.random() - 0.5);
                    validCards.forEach((c, i) => { c.dataset.icon = icons[i]; c.querySelector('.front').innerText = icons[i]; });
                    gsap.to(validCards, { duration: 0.5, scale: 1, rotation: 0, x: 0, y: 0, opacity: 1, ease: "back.out(1.7)", onComplete: () => { validCards.forEach(c => c.classList.remove('chaos-glow')); game.chaosActive = false; } });
                }
            });
        }
        function quiz(msg) { clearInterval(timer); clearTimeout(chaosTimer); clearTimeout(tauntTimer); const m=document.getElementById('modal-quiz'); const p=document.getElementById('quiz-paper'); const q=triviaDB[Math.floor(Math.random()*triviaDB.length)]; document.getElementById('quiz-q').innerText=q.p; const c=document.getElementById('quiz-ops'); c.innerHTML=''; q.o.forEach((op, i)=>{ const d=document.createElement('button'); d.className='quiz-opt-btn'; d.innerText=op; d.onclick=()=>{playS('click');if(i===q.r)quizSuccess();else quizFail();}; c.appendChild(d); }); m.style.display='flex'; playS('paper'); gsap.fromTo(p, {scale:0, rotation:-720, opacity:0}, {scale:1, rotation:0, opacity:1, duration:1, ease:"back.out"}); }
        function quizSuccess() { playS('mischief'); document.getElementById('modal-quiz').style.display='none'; notificar("Correto! Segunda chance."); startTimer(20); }
        function quizFail() { playS('thunder'); document.getElementById('modal-quiz').style.display='none'; notificar("Errado! Fim de jogo."); sairParaMenu(); }

        /* --- 6. UTILIT√ÅRIOS E UI --- */
        function playS(k){if(sfx[k])sfx[k].cloneNode().play().catch(()=>{});}
        function notificar(msg){const b=document.getElementById('notif-bar');b.innerText=msg;b.classList.add('show');setTimeout(()=>b.classList.remove('show'),2500);}
        function showCombo(v){if(v<2)return;const c=document.getElementById('combo-container');c.innerHTML=`<div class="combo-text">COMBO x${v}!</div>`;playS('combo');setTimeout(()=>c.innerHTML='',1000);}
        function showFloatScore(el,pts){const r=el.getBoundingClientRect();const f=document.createElement('div');f.innerText="+"+pts;f.className='float-score';f.style.left=(r.left+r.width/2)+'px';f.style.top=r.top+'px';document.body.appendChild(f);setTimeout(()=>f.remove(),1000);}
        function checkSave(){const s=localStorage.getItem('aa_save');const b=document.getElementById('btn-continue');if(s)b.classList.remove('disabled');else b.classList.add('disabled');}
        
        function fecharJogo() { playS('click'); document.getElementById('exit-screen').style.display='flex'; setTimeout(()=>document.getElementById('exit-screen').style.opacity=1,10); setTimeout(()=>{ if(ipcRenderer)ipcRenderer.send('app-quit'); else window.close(); },2000); }
        function sairParaMenu() { clearInterval(timer); clearTimeout(chaosTimer); audioManager.playMenu(); navegar('screen-menu'); checkSave(); document.getElementById('dynamic-bg-layer').className='env-default'; }
        function closeMagicAlert() { document.getElementById('magic-modal-content').classList.remove('show'); setTimeout(()=>document.getElementById('magic-alert-modal').style.display='none',300); }

        function abrirPerfilMenu(){navegar('screen-profile');if(prof.nome!=="Aprendiz"){document.getElementById('profile-edit').style.display='none';document.getElementById('profile-dash').style.display='block';}else{document.getElementById('profile-edit').style.display='block';document.getElementById('profile-dash').style.display='none';}}
        function salvarPerfil(){const n=document.getElementById('prof-name-input').value;if(n)prof.nome=n;localStorage.setItem('aa_prof',JSON.stringify(prof));updateProfUI();abrirPerfilMenu();}
        function editarPerfil(){document.getElementById('profile-dash').style.display='none';document.getElementById('profile-edit').style.display='block';}
        function mudarAvatar(d){prof.av=(prof.av+d+avatares.length)%avatares.length;updateProfUI();}
        function updateProfUI(){const a=avatares[prof.av];document.getElementById('prof-av-edit').src=`Imagens/Personagens/${a.file}`;document.getElementById('dash-av-img').src=`Imagens/Personagens/${a.file}`;document.getElementById('hud-av-img').src=`Imagens/Personagens/${a.file}`;document.getElementById('dash-name').innerText=prof.nome;document.getElementById('hud-name').innerText=prof.nome;document.getElementById('dash-lvl').innerText=prof.lvl;document.getElementById('dash-title').innerText=titulos[Math.min(Math.floor((prof.lvl-1)/5),titulos.length-1)];}
        function openConfigMenu(o){lastScreen=o==='game'?'screen-game':'screen-menu';navegar('screen-settings');}
        function voltarConfig(){navegar(lastScreen);}
        function applySettings(){audioManager.updateVolume();document.getElementById('rng-musica').value=cfg.m;document.getElementById('rng-sfx').value=cfg.s;document.getElementById('chk-part').checked=cfg.part;setGfx('part',cfg.part);}
        function setGfx(t,v){cfg[t]=v;if(t==='part')document.body.classList.toggle('no-particles',!v);localStorage.setItem('aa_cfg',JSON.stringify(cfg));}
        function setAudio(t,v){if(t==='m')cfg.m=v;if(t==='s')cfg.s=v;localStorage.setItem('aa_cfg',JSON.stringify(cfg));audioManager.updateVolume();}
        function deletarSave() { if(confirm("Apagar tudo?")) { localStorage.removeItem('aa_prof'); localStorage.removeItem('aa_save'); location.reload(); } }

        function initParticles(){const c=document.getElementById('magic-canvas');const ctx=c.getContext('2d');c.width=window.innerWidth;c.height=window.innerHeight;let ps=[];class P{constructor(){this.x=Math.random()*c.width;this.y=Math.random()*c.height;this.s=Math.random()*2;this.sy=Math.random();this.o=Math.random()*0.5;}u(){this.y-=this.sy;if(this.y<0)this.y=c.height;}d(){ctx.fillStyle=`rgba(0,210,255,${this.o})`;ctx.beginPath();ctx.arc(this.x,this.y,this.s,0,Math.PI*2);ctx.fill();}}for(let i=0;i<50;i++)ps.push(new P());function ani(){ctx.clearRect(0,0,c.width,c.height);ps.forEach(p=>{p.u();p.d();});requestAnimationFrame(ani);}ani();}
        function scheduleTaunt(){clearTimeout(tauntTimer);const t=Math.random()*5000+10000;tauntTimer=setTimeout(()=>{const b=bosses[currentBossIndex];if(b){const p=b.phrases[Math.floor(Math.random()*b.phrases.length)];const bb=document.getElementById('boss-speech');bb.innerText=p;bb.style.opacity=1;bb.style.top="-120px";gsap.fromTo(bb,{y:20},{y:0,duration:0.3});setTimeout(()=>bb.style.opacity=0,4000);}scheduleTaunt();},t);}
        function resetAFKTimer(){clearTimeout(afkTimer);if(game.afkMode){gsap.to("body",{filter:"none",scale:1,duration:1});game.afkMode=false;}afkTimer=setTimeout(()=>{game.afkMode=true;gsap.to("body",{filter:"blur(5px) sepia(0.5)",scale:1.02,duration:5,repeat:-1,yoyo:true});notificar("zzz...");},300000);}

        function checkAchievements(t){achievementsDB.forEach(a=>{if(globalData.achievements.includes(a.id))return;let u=false;
            if(t==='game_start'){if(a.id==='veteran_10'&&prof.totalGames>=10)u=true;if(a.id==='veteran_50'&&prof.totalGames>=50)u=true;if(a.id==='veteran_100'&&prof.totalGames>=100)u=true;}
            if(t==='levelup'){if(a.id==='lvl_5'&&prof.lvl>=5)u=true;if(a.id==='lvl_10'&&prof.lvl>=10)u=true;if(a.id==='lvl_25'&&prof.lvl>=25)u=true;if(a.id==='lvl_50'&&prof.lvl>=50)u=true;if(a.id==='lvl_100'&&prof.lvl>=100)u=true;}
            if(u){globalData.achievements.push(a.id);localStorage.setItem('aa_global',JSON.stringify(globalData));showAch(a);}
        });}
        function showAch(a){const p=document.getElementById('achievement-popup');document.getElementById('ach-pop-icon').innerText=a.icon;document.getElementById('ach-pop-title').innerText=a.title;document.getElementById('ach-pop-desc').innerText=a.desc;playS('achievement');p.classList.add('show');setTimeout(()=>p.classList.remove('show'),5000);}

        let currentBookPage = 0;
        function abrirGrimorioDireto() { navegar('screen-credits'); currentBookPage = 0; renderBookPage(); }
        function renderBookPage() { const c = document.getElementById('book-content'); const pNum = document.getElementById('page-num');
            gsap.to(c, {opacity:0, duration:0.3, onComplete:()=>{
                if(currentBookPage===0) c.innerHTML=`<div class="grimoire-intro-text">O Grim√≥rio Sagrado.</div>`;
                else if(currentBookPage<=10) { const b=bosses[currentBookPage-1]; c.innerHTML=`<div class="boss-portrait"><img src="Imagens/Monstros/${b.file}"></div><h2>${b.n}</h2><p>${b.lore}</p>`; }
                else if(currentBookPage===11) { let h='<div class="ach-list">'; achievementsDB.forEach(a=>{ h+=`<div class="ach-item ${globalData.achievements.includes(a.id)?'unlocked':''}"><div class="ach-item-icon">${a.icon}</div><div><h4>${a.title}</h4><p>${a.desc}</p></div></div>`; }); c.innerHTML=h+'</div>'; }
                pNum.innerText=currentBookPage+1; gsap.to(c,{opacity:1,duration:0.3});
            }});
        }
        function nextPage(){if(currentBookPage<12){currentBookPage++;renderBookPage();}} function prevPage(){if(currentBookPage>0){currentBookPage--;renderBookPage();}}
        function getRewards(lvl) { let cardSkin = ''; let aura = ''; let hitEffect = 'boss-hit'; if (lvl >= 80) { cardSkin = 'card-skin-cosmic'; aura = 'aura-light'; hitEffect = 'boss-hit-void'; } else if (lvl >= 60) { cardSkin = 'card-skin-mythril'; aura = 'aura-shadow'; hitEffect = 'boss-hit-shock'; } else if (lvl >= 40) { cardSkin = 'card-skin-diamond'; aura = 'aura-lightning'; hitEffect = 'boss-hit-fire'; } else if (lvl >= 20) { cardSkin = 'card-skin-gold'; aura = 'aura-fire'; hitEffect = 'boss-hit-ice'; } else if (lvl >= 5) { cardSkin = 'card-skin-silver'; aura = 'aura-ice'; } return { cardSkin, aura, hitEffect }; }
    </script>
</body>
</html>